"use strict";(self.webpackChunkmia_erp=self.webpackChunkmia_erp||[]).push([[494],{3007:function(e,n,i){i.d(n,{B:function(){return P}});var t=i(1413),o=i(4925),l=i(9006),a=i(3691),d=i(2989),r=i(4990),u=i(6522),s=i(6681),c=i(8095),f=i(3423),v=i(870),p=i(4343),m=i(959),h=i(9994),b=i(1494),g=i(4897),x=i(7348),Z=i(3383),S=i(389),j=i(9964),y=i(3329),L=["formState","register","registerSelect","formValues","setValue","handleSubmit"],P=function(e){var n,i=e.defaultValues,P=e.edit,_=e.type,V=e.onSuccess,C=e._id,O=(0,b.useOfferLoadersProvider)(),I=O.isLoading,B=O.onLoading,D=(0,h.Z)(),E=(0,x.eO)(),F=(0,x.q$)(v.cA.COUNTERPARTIES).directory,w=(0,x.q$)(v.cA.BRANDS).directory,M=(0,d.hN)({defaultValues:(0,t.Z)((0,t.Z)({visible:!1,approved:a.Hb.pending},i),{},{type:_})}),k=M.formState.errors,A=M.register,K=M.registerSelect,R=M.formValues,T=M.setValue,q=M.handleSubmit,J=(0,o.Z)(M,L);return(0,y.jsx)(y.Fragment,{children:(0,y.jsxs)(l.h,{label:(0,u.t)("Base info"),isLoading:P?null===I||void 0===I?void 0:I.offer_update:null===I||void 0===I?void 0:I.offer_create,onSubmit:q((function(e){var n=(0,m.vg)(e,{ignorePaths:["measurement"]});P?D.updateById({data:{data:{data:n,_id:C}},onSuccess:V,onLoading:B("offer_update")}):D.create({data:{data:{data:n}},onSuccess:V,onLoading:B("offer_create")})})),onReset:J.reset,canSubmit:!0,expandable:!1,children:[(0,y.jsx)(j.Z,{value:null!==(n=null===R||void 0===R?void 0:R.type)&&void 0!==n?n:a.iv.GOODS,options:Z.LC,onSelect:function(e){return T("type",e.value)}}),(0,y.jsx)(r.Z,{label:(0,u.t)("label"),error:k.label,required:!0,children:(0,y.jsx)(s.ZP,(0,t.Z)((0,t.Z)({placeholder:(0,u.t)("label")},A("label")),{},{required:!0,autoFocus:!0}))}),(0,y.jsxs)(c.ZP,{fxDirection:"row",gap:12,fillWidth:!0,children:[(0,y.jsx)(r.Z,{label:(0,u.t)("sku"),error:k.sku,children:(0,y.jsx)(s.ZP,(0,t.Z)({placeholder:(0,u.t)("sku")},A("sku")))}),(0,y.jsx)(r.Z,{label:(0,u.t)("Bar-code"),error:k.barCode,children:(0,y.jsx)(s.ZP,(0,t.Z)({placeholder:(0,u.t)("Bar-code")},A("barCode")))})]}),(0,y.jsx)(f.Z,(0,t.Z)({},K("brand",{options:w,label:(0,u.t)("brand"),placeholder:(0,u.t)("selectBrand")}))),(0,y.jsx)(f.Z,(0,t.Z)({},K("warehouse",{options:E.warehouses,label:(0,u.t)("Select warehouse"),placeholder:(0,u.t)("Select warehouse")}))),(0,y.jsx)(f.Z,(0,t.Z)({},K("supplier",{options:F,label:(0,u.t)("Select supplier"),placeholder:(0,u.t)("Select supplier")}))),(0,y.jsx)(f.Z,(0,t.Z)({},K("approved",{options:g.SQ,label:(0,u.t)("status"),placeholder:(0,u.t)("status"),onlyValue:!0,valuePath:"approved"}))),(0,y.jsx)(r.Z,{label:(0,u.t)("description"),error:k.description,children:(0,y.jsx)(p.Z,(0,t.Z)({placeholder:(0,u.t)("description")},A("description")))}),(0,y.jsx)(r.Z,{label:(0,u.t)("Visibility"),error:k.description,children:(0,y.jsx)(S.Z,{value:R.visible,onChange:function(e){T("visible",e,{shouldTouch:!0,shouldDirty:!0})}})})]})})}},5169:function(e,n,i){i.d(n,{Z:function(){return C}});var t=i(9439),o=i(9006),l=i(1413),a=i(7348),d=i(2791),r=i(8095),u=i(4990),s=i(6522),c=i(3383),f=i(9953),v=i(2603),p=i(7802),m=i(4066),h=i(459),b=i(2928),g=i(2360),x=i(3665),Z=i(4719),S=i(3329),j=function(e){e.selected,e.onSelect;var n=e.filterValue,i=void 0===n?{type:v.h.OFFER}:n,o=e.onChangeIds,j=e.value,y=e.hideFilter,L=(0,g.Fg)(),P=(0,m.TL)(),_=(0,a.n6)(),V=(0,x.kw)(),C=(0,d.useState)(i),O=(0,t.Z)(C,2),I=O[0],B=O[1],D=(0,d.useMemo)((function(){var e,n=I.type;return null===(e=_.listsMap)||void 0===e?void 0:e[n]}),[I.type,_.listsMap]);(0,d.useEffect)((function(){null!==D&&void 0!==D&&D.length||P((0,h.Sn)({params:{type:I.type}}))}),[P,I.type,D,null===D||void 0===D?void 0:D.length]);return(0,S.jsxs)(r.ZP,{gap:8,children:[(0,S.jsx)(r.ZP,{fxDirection:"row",gap:8,padding:"0 0 8px",borderBottom:"1px solid ".concat(L.modalBorderColor),justifyContent:"flex-end",children:(0,S.jsx)(b.ZP,{variant:"text",sizeType:"extraSmall",onClick:function(){V.create(Z.Z,{defaultValues:{type:I.type}})},children:(0,s.t)("Add")})}),!y&&(0,S.jsx)(u.Z,{label:(0,s.t)("Select tags group"),children:(0,S.jsx)(f.Z,{options:c.fz,defaultValue:I.type,onSelect:function(e){var n=e.value;n&&B((function(e){return(0,l.Z)((0,l.Z)({},e),{},{type:n})}))}})}),(0,S.jsx)(p.Z,{multiple:!0,options:D,onChangeIds:o,value:j})]})},y=i(2989),L=i(1494),P=i(959),_=i(1819),V=i(763),C=function(e){var n,i=e.disabled,l=e.offer,a=(0,y.G2)(l),r=(0,L.useOfferLoadersProvider)(),u=(0,P.sK)(null===a||void 0===a||null===(n=a.tags)||void 0===n?void 0:n.map((function(e){return e._id}))),s=(0,_.xc)()[_.EJ.offers],c=(0,d.useState)(u),f=(0,t.Z)(c,2),p=f[0],m=f[1],h=(0,d.useMemo)((function(){return!(null===p||void 0===p||!p.length)&&(null===u||void 0===u?void 0:u.join(","))!==(0,P.sK)(p).join(",")}),[u,p]);return(0,d.useEffect)((function(){null!==a&&void 0!==a&&a.tags&&m((0,P.SJ)(null===a||void 0===a?void 0:a.tags))}),[]),(0,S.jsx)(o.h,{label:"Tags",isOpen:!1,disabled:i,onSubmit:function(e){e.preventDefault(),e.stopPropagation(),a&&s.updateById({onLoading:r.onLoading("tags"),data:{data:{_id:a._id,data:{tagsIds:p}}}})},canSubmit:h,isLoading:r.isLoading.tags,children:(0,S.jsx)(j,{filterValue:{type:v.h.OFFER},hideFilter:!0,value:p,onChangeIds:function(e){var n=e.value;m((0,V.isArray)(n)?n:[n])}})})}},7608:function(e,n,i){i.d(n,{A:function(){return b}});var t,o=i(168),l=i(9439),a=i(2791),d=i(9006),r=i(2360),u=i(8095),s=i(1819),c=i(1494),f=i(6522),v=i(959),p=i(9184),m=i(2989),h=i(3329),b=function(e){var n,i,t=e.offer,o=e.disabled,r=(0,m.G2)(t),u=(0,c.useOfferLoadersProvider)(),b=(0,v.sK)(null===r||void 0===r||null===(n=r.categories)||void 0===n?void 0:n.map((function(e){return e._id}))),x=(0,s.xc)()[s.EJ.offers],Z=(0,a.useState)(b),S=(0,l.Z)(Z,2),j=S[0],y=S[1],L=(0,a.useMemo)((function(){return!(null===j||void 0===j||!j.length)&&(null===b||void 0===b?void 0:b.join(","))!==(0,v.sK)(j).join(",")}),[b,j]);return(0,a.useEffect)((function(){null!==r&&void 0!==r&&r.categories&&y((0,v.SJ)(null===r||void 0===r?void 0:r.categories))}),[]),(0,h.jsx)(d.h,{label:(0,f.t)("Categories"),onSubmit:function(e){e.preventDefault(),r&&x.updateById({onLoading:u.onLoading("categories"),data:{data:{_id:r._id,data:{categories:j}}},onSuccess:function(e,n){}})},disabled:o,isLoading:null===(i=u.isLoading)||void 0===i?void 0:i.categories,canSubmit:L,maxHeight:"300px",isOpen:!1,children:(0,h.jsx)(g,{flex:1,overflow:"auto",children:(0,h.jsx)(p.Z,{onChangeIds:y,offer:r})})})},g=(0,r.ZP)(u.j6)(t||(t=(0,o.Z)(["\n  padding-bottom: 8px;\n"])))},9420:function(e,n,i){i.d(n,{A:function(){return y}});var t,o=i(1413),l=i(9439),a=i(4925),d=i(168),r=i(6522),u=i(2791),s=i(8095),c=i(4990),f=i(6681),v=i(2360),p=i(3329),m=[{name:"height",label:(0,r.t)("Height"),placeholder:(0,r.t)("Sm")},{name:"width",label:(0,r.t)("Width"),placeholder:(0,r.t)("Sm")},{name:"length",label:(0,r.t)("Length"),placeholder:(0,r.t)("Sm")},{name:"weight",label:(0,r.t)("Weight"),placeholder:(0,r.t)("Kg")}],h=(0,v.ZP)(s.ZP)(t||(t=(0,d.Z)(["\n  display: grid;\n  grid-template-columns: repeat(2, 1fr);\n  column-gap: 8px;\n\n  @media screen and (min-width: 480px) {\n    grid-template-columns: repeat(4, 1fr);\n  }\n"]))),b=function(e){var n,i,t=e.form,l=e.disabled,a=null===t||void 0===t||null===(n=t.formState)||void 0===n||null===(i=n.errors)||void 0===i?void 0:i.dimensions;return(0,p.jsx)(h,{fillWidth:!0,children:m.map((function(e){return(0,p.jsx)(c.Z,{label:e.label,error:a&&a[e.name],children:(0,p.jsx)(f.ZP,(0,o.Z)((0,o.Z)({placeholder:e.placeholder,min:1,type:"number"},t.register("dimensions.".concat(e.name),{valueAsNumber:!0,min:1})),{},{disabled:l}))},e.name)}))})},g=i(2989),x=i(9006),Z=i(9994),S=i(1383),j=["defaultValues","_id","disabled"],y=function(e){var n,i,t,d=e.defaultValues,s=e._id,c=e.disabled,f=(0,a.Z)(e,j),v=(0,Z.Z)(),m=(0,u.useState)(!1),h=(0,l.Z)(m,2),y=h[0],L=h[1],P=(0,g.hN)({defaultValues:{dimensions:null!==d&&void 0!==d?d:{}}}),_=!(null===(n=P.formState.dirtyFields)||void 0===n||!n.dimensions)&&(null===(i=Object.values(null===(t=P.formState.dirtyFields)||void 0===t?void 0:t.dimensions))||void 0===i?void 0:i.some((function(e){return e})));return(0,p.jsx)(x.h,(0,o.Z)((0,o.Z)({onSubmit:P.handleSubmit((function(e){v.updateById({data:{data:{data:e,_id:s}},onSuccess:function(e){S.kl.success("Product updated")},onError:function(e){console.error("Product update action",e)},onLoading:L})})),label:(0,r.t)("Package size"),isLoading:y,isOpen:!1},f),{},{disabled:!_||c,children:(0,p.jsx)(b,{form:P,disabled:c})}))}},5888:function(e,n,i){i.d(n,{A:function(){return v}});var t=i(1413),o=i(9439),l=i(1494),a=i(1819),d=i(2791),r=i(9006),u=i(713),s=i(959),c=i(6522),f=i(3329),v=function(e){var n,i,v=e.offer,p=e.onSubmit,m=e.onSuccess,h=e.disabled,b=e.defaultValues,g=(0,l.useOfferLoadersProvider)(),x=(0,d.useState)(b||(null===g||void 0===g||null===(n=g.state)||void 0===n?void 0:n.images)||[]),Z=(0,o.Z)(x,2),S=Z[0],j=Z[1],y=(0,a.xc)()[a.EJ.offers],L=(0,d.useMemo)((function(){return!(null===S||void 0===S||!S.length)}),[null===S||void 0===S?void 0:S.length]);return(0,f.jsx)(r.h,{label:(0,c.t)("Images"),onSubmit:function(e){e.preventDefault(),e.stopPropagation(),p?p(S):v?y.updateById({data:{refresh:!0,data:(0,t.Z)((0,t.Z)({},(0,s.rE)(v)),{},{data:{images:S}})},onSuccess:m,onLoading:g.onLoading("images")}):console.warn("Offer not passed")},canSubmit:L,disabled:h,isLoading:null===(i=g.isLoading)||void 0===i?void 0:i.images,isOpen:!1,maxHeight:"400px",children:(0,f.jsx)(u.Z,{hideLabel:!0,initialData:S,onChangeState:j,contentContainerStyle:{flex:1}})})}},9306:function(e,n,i){i.d(n,{n:function(){return y}});var t=i(1413),o=i(9439),l=i(4925),a=i(8553),d=i(3423),r=i(4990),u=i(6681),s=i(8095),c=i(2791),f=i(6522),v=i(3096),p=i(3329),m=(0,a.H1)(v.q),h=[{name:"measurement.unit",label:(0,f.t)("unit"),placeholder:(0,f.t)("unit"),options:m},{name:"measurement.min",label:(0,f.t)("min"),placeholder:(0,f.t)("min"),type:"number"},{name:"measurement.max",label:(0,f.t)("max"),placeholder:(0,f.t)("max"),type:"number"}],b=function(e){var n=e.appForm,i=e.disabled;return(0,p.jsx)(s.ZP,{fillWidth:!0,style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr",columnGap:8},children:h.map((function(e){var o;return e.options?(0,p.jsx)(d.Z,(0,t.Z)((0,t.Z)({},n.registerSelect(null===e||void 0===e?void 0:e.name,{options:null===e||void 0===e?void 0:e.options,label:null===e||void 0===e?void 0:e.label,placeholder:null===e||void 0===e?void 0:e.label,onlyValue:!0})),{},{disabled:i}),e.name):(0,p.jsx)(r.Z,{label:e.label,error:null===n||void 0===n||null===(o=n.formState)||void 0===o?void 0:o.errors[e.name],children:(0,p.jsx)(u.ZP,(0,t.Z)((0,t.Z)({placeholder:e.placeholder,min:"number"===(null===e||void 0===e?void 0:e.type)?1:void 0,type:null===e||void 0===e?void 0:e.type},n.register(e.name,{valueAsNumber:"number"===(null===e||void 0===e?void 0:e.type),min:"number"===(null===e||void 0===e?void 0:e.type)?1:void 0})),{},{disabled:i}))},e.name)}))})},g=i(2989),x=i(9006),Z=i(9994),S=i(1383),j=["defaultValues","_id","disabled"],y=function(e){var n,i,a,d=e.defaultValues,r=e._id,u=e.disabled,s=(0,l.Z)(e,j),v=(0,Z.Z)(),m=(0,c.useState)(!1),h=(0,o.Z)(m,2),y=h[0],L=h[1],P=(0,g.hN)({defaultValues:{measurement:d}}),_=!(null===(n=P.formState.dirtyFields)||void 0===n||!n.measurement)&&(null===(i=Object.values(null===(a=P.formState.dirtyFields)||void 0===a?void 0:a.measurement))||void 0===i?void 0:i.some((function(e){return e})));return(0,p.jsx)(x.h,(0,t.Z)((0,t.Z)({onSubmit:P.handleSubmit((function(e){v.updateById({data:{data:{data:e,_id:r}},update:!0,onSuccess:function(e){S.kl.success("Product updated")},onError:function(e){console.error("Product update action",e)},onLoading:L})})),label:(0,f.t)("Measurement info"),isLoading:y,disabled:!_||u,isOpen:!1},s),{},{children:(0,p.jsx)(b,{appForm:P,disabled:u})}))}},8160:function(e,n,i){i.d(n,{R:function(){return S}});var t,o=i(168),l=i(7762),a=i(9439),d=i(2791),r=i(9006),u=i(2360),s=i(8095),c=i(7348),f=i(1819),v=i(1494),p=i(6522),m=i(2825),h=i(4809),b=i(6492),g=i(2989),x=i(959),Z=i(3329),S=function(e){var n,i,t=e.onSuccess,o=e.disabled,u=e.offer,S=(0,v.useOfferLoadersProvider)(),y=(0,c.i7)(),L=(0,g.G2)(u),P=(0,f.xc)().get(f.EJ.offers),_=(0,x.sK)(null===L||void 0===L||null===(n=L.properties)||void 0===n?void 0:n.map((function(e){return e._id}))),V=(0,d.useState)(_),C=(0,a.Z)(V,2),O=C[0],I=C[1],B=(0,d.useState)(),D=(0,a.Z)(B,2),E=D[0],F=D[1],w=(0,d.useMemo)((function(){var e;return!(null===O||void 0===O||!O.length)&&(null===_||void 0===_?void 0:_.join(","))!==(null===(e=(0,x.sK)(O))||void 0===e?void 0:e.join(","))}),[O,_]),M=(0,d.useMemo)((function(){var e,n,i;if(null!==E&&void 0!==E&&null!==(e=E.childrenList)&&void 0!==e&&e.length)return null===E||void 0===E?void 0:E.childrenList.filter((function(e){return!(null!==e&&void 0!==e&&e.isSelectable)}));var t,o=null===E||void 0===E?void 0:E._id,a=[],d=null!==(n=null===(i=y.propertiesKeysMap)||void 0===i?void 0:i[null!==o&&void 0!==o?o:"def"])&&void 0!==n?n:[],r=(0,l.Z)(d);try{for(r.s();!(t=r.n()).done;){var u,s=t.value,c=null===(u=y.propertiesDataMap)||void 0===u?void 0:u[s];if(c&&(null===c||void 0===c||!c.isSelectable)){var f=y.propertiesKeysMap[null===c||void 0===c?void 0:c._id];null!==f&&void 0!==f&&f.length&&a.push(c)}}}catch(v){r.e(v)}finally{r.f()}return a}),[E,y.propertiesDataMap,y.propertiesKeysMap]),k=(0,d.useCallback)((function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";I((function(e){return(0,x.ES)({arr:e,id:n,toggle:!0})}))}),[]),A=(0,d.useMemo)((function(){return null===M||void 0===M?void 0:M.map((function(e){return(0,Z.jsx)(h.Z,{item:e,selectedIds:O,onSelect:k},"prop_".concat(e._id))}))}),[M,O,k]);return(0,Z.jsxs)(r.h,{label:(0,p.t)("Properties"),canSubmit:w,onSubmit:function(e){e.preventDefault(),L&&P.updateById({data:{data:{_id:null===L||void 0===L?void 0:L._id,data:{properties:O}}},update:!0,onLoading:S.onLoading("properties"),onSuccess:t})},isLoading:null===(i=S.isLoading)||void 0===i?void 0:i.properties,isOpen:!1,disabled:!L||o,children:[(0,Z.jsx)(m.c,{selected:E,onSelect:F}),(0,Z.jsx)(j,{flex:1,overflow:"auto",children:null!==A&&void 0!==A&&A.length?A:(0,Z.jsx)(s.ZP,{padding:"24px",alignItems:"center",justifyContent:"center",children:(0,Z.jsx)(b.x,{$size:16,children:(0,p.t)("Data not found")})})})]})},j=(0,u.ZP)(s.ZP)(t||(t=(0,o.Z)(["\n  padding-bottom: 8px;\n"])))},1494:function(e,n,i){i.r(n),i.d(n,{useOfferLoadersProvider:function(){return Z}});var t=i(9420),o=i(8050),l=i(6522),a=i(959),d=i(2791),r=i(9306),u=i(3007),s=i(8095),c=i(8160),f=i(9541),v=i(7578),p=i(5888),m=i(2989),h=i(7608),b=i(5248),g=i(5169),x=i(3329),Z=function(){return(0,v.un)()};n.default=function(e){var n,i=e.onClose,Z=(e._id,(0,f.J)()),S=Z.state.formData,j=Z.setData,y=(0,m.xj)(),L=(0,m.G2)({_id:null===(n=y.query)||void 0===n?void 0:n.offerId});return(0,d.useEffect)((function(){}),[]),(0,x.jsx)(o.Z,{title:(0,l.t)("Create offer"),onClose:i,children:(0,x.jsx)(v.f4,{value:Z,children:(0,x.jsxs)(s.ZP,{padding:"0 8px 16px",children:[(0,x.jsx)(u.B,{defaultValues:S,onSuccess:function(e){var n=e.data;j("formData",(0,a.xT)(n)),y.push({query:{offerId:null===n||void 0===n?void 0:n._id}})},type:null===S||void 0===S?void 0:S.type}),L&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(h.A,{offer:L,defaultValues:null===S||void 0===S?void 0:S.categories,disabled:!S}),(0,x.jsx)(c.R,{offer:L,defaultValues:null===S||void 0===S?void 0:S.properties,disabled:!S}),(0,x.jsx)(b.L,{expandable:!0,isOpen:!1,offer:L,defaultState:null===L||void 0===L?void 0:L.price,price:null===L||void 0===L?void 0:L.price,title:(0,l.t)("Price")}),(0,x.jsx)(p.A,{offer:L,defaultValues:null===S||void 0===S?void 0:S.images,disabled:!S}),(0,x.jsx)(g.Z,{offer:L,defaultValues:null===S||void 0===S?void 0:S.tagsIds,disabled:!S}),(0,x.jsx)(t.A,{offer:L,defaultValues:null===S||void 0===S?void 0:S.dimensions,disabled:!S}),(0,x.jsx)(r.n,{offer:L,defaultValues:null===S||void 0===S?void 0:S.measurement,disabled:!S})]})]})})})}}}]);
//# sourceMappingURL=494.c2e1d919.chunk.js.map
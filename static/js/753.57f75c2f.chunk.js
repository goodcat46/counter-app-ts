"use strict";(self.webpackChunkcounter_app_ts=self.webpackChunkcounter_app_ts||[]).push([[753],{3753:function(e,n,t){t.r(n),t.d(n,{RenderVariationProperty:function(){return z}});var i,r,o,l,d,a,s,u,c=t(168),p=t(4942),h=t(1413),x=t(9439),m=t(4925),f=t(2360),Z=t(8095),b=t(8302),v=t(7348),g=t(2437),S=t(2791),j=t(6492),w=t(2655),C=t(1383),P=t(6757),y=t(4838),k=t(6727),B=t(4695),_=t(7426),L=t(4990),I=t(6681),W=t(6522),M=t(4538),T=t(3329),A=["onClose","title","defaultState","onSubmit","update","create"],E=[{name:"dimensions.height",label:(0,W.t)("Height"),placeholder:(0,W.t)("Sm")},{name:"dimensions.width",label:(0,W.t)("Width"),placeholder:(0,W.t)("Sm")},{name:"dimensions.length",label:(0,W.t)("Length"),placeholder:(0,W.t)("Sm")},{name:"dimensions.weight",label:(0,W.t)("Weight"),placeholder:(0,W.t)("Kg")}],V=k.Ry().shape({label:k.Z_().required().min(5).max(50),sku:k.Z_().required().min(8).max(36),barCode:k.Z_(),propertiesMap:k.Ry().shape({}),product:k.Ry().shape({label:k.Z_(),_id:k.Z_()}),timeFrom:k.hT(),timeTo:k.hT()}),z=function(e){var n=e.item,t=e.selectedIds,i=void 0===t?[]:t,r=e.onSelect,o=(0,S.useMemo)((function(){var e;return null===(e=n.childrenList)||void 0===e?void 0:e.map((function(e){var t=i.includes(e._id);return(0,T.jsx)(J,{item:e,isSelected:t,onSelect:function(t){return r&&r(n._id,t,null===e||void 0===e?void 0:e.label)}},"prop-value-".concat(e._id))}))}),[n._id,n.childrenList,r,i]);return(0,T.jsxs)(F,{gap:8,fillWidth:!0,padding:"8px 0 0",children:[(0,T.jsx)(j.x,{style:{flex:1,paddingLeft:12},$weight:500,children:n.label}),(0,T.jsx)(D,{fillWidth:!0,padding:"8px 0",gap:6,numColumns:n.label&&["\u0440\u043e\u0437\u043c\u0456\u0440"].includes(n.label.toLowerCase())?4:3,children:o})]},"property-box-".concat(n._id))},R=f.ZP.form(i||(i=(0,c.Z)(["\n  flex: 1;\n\n  display: flex;\n  flex-direction: column;\n  width: 100%;\n  padding: 0 8px;\n\n  overflow: hidden;\n\n  max-width: 480px;\n  color: ",";\n  background-color: ",";\n"])),(function(e){return e.theme.fontColorSidebar}),(function(e){return e.theme.tableBackgroundColor})),q=(0,f.ZP)(Z.ZP)(r||(r=(0,c.Z)(["\n  border-top: 1px solid ",";\n  border-bottom: 1px solid ",";\n"])),(function(e){return e.theme.sideBarBorderColor}),(function(e){return e.theme.sideBarBorderColor})),O=(0,f.ZP)(Z.ZP)(o||(o=(0,c.Z)(["\n  padding-bottom: 8px;\n"]))),F=(0,f.ZP)(Z.ZP)(l||(l=(0,c.Z)(["\n  border-top: 1px solid ",";\n  &:last-child {\n    border-bottom: 1px solid ",";\n  }\n"])),(function(e){return e.theme.sideBarBorderColor}),(function(e){return e.theme.sideBarBorderColor})),D=(0,f.ZP)(Z.ZP)(d||(d=(0,c.Z)(["\n  width: 100%;\n  display: grid;\n  grid-template-columns: repeat(",", 1fr);\n"])),(function(e){var n=e.numColumns;return void 0===n?2:n})),H=(0,f.ZP)(Z.ZP)(a||(a=(0,c.Z)([""]))),N=(0,f.ZP)(Z.ZP)(s||(s=(0,c.Z)(["\n  border-bottom: 1px solid ",";\n"])),(function(e){return e.theme.sideBarBorderColor})),$=(0,f.ZP)(b.Z)(u||(u=(0,c.Z)(["\n  width: 100%;\n  max-width: 100%;\n  min-width: 50px;\n"]))),J=function(e){var n=e.item,t=e.isSelected,i=e.onSelect,r=(0,S.useState)(!1),o=(0,x.Z)(r,2),l=o[0],d=o[1];return(0,S.useEffect)((function(){M.sr.isUnd(t)||d(t)}),[t]),(0,T.jsx)($,{variant:l?"filledSmall":"outlinedSmall",padding:"6px 8px",fontWeight:500,onClick:function(){i&&i(n._id)},children:n.label})};n.default=function(e){var n=e.onClose,t=e.title,i=e.defaultState,r=e.onSubmit,o=e.update,l=(e.create,(0,m.Z)(e,A)),d=(0,P.d)(),a=(0,v.nr)().currentProduct,s=(0,g.xc)()[g.EJ.products],u=(0,v.WS)(),c=(0,S.useState)(!1),f=(0,x.Z)(c,2),b=f[0],j=f[1],k=(0,_.hN)({defaultValues:(0,w.Ls)(i?(0,h.Z)((0,h.Z)({},i),{},{product:a}):{product:a}),resolver:(0,B.X)(V),reValidateMode:"onSubmit"}),M=k.setValue,F=k.handleSubmit,D=k.register,$=k.formState.errors,J=k.formValues,K=(0,S.useState)({}),U=(0,x.Z)(K,2),X=U[0],G=U[1];(0,S.useEffect)((function(){if(!o){var e="";console.log(X);var n=Object.values(X);if(0!==n.length){var t=n.join(". ");e=null!==a&&void 0!==a&&a.label?"".concat(null===a||void 0===a?void 0:a.label,". ").concat(t):t,M("label",e)}else e="".concat(null===a||void 0===a?void 0:a.label,". {{VARIATION_LABEL}}")}}),[null===a||void 0===a?void 0:a.label,X,M,o]);var Q=(0,S.useMemo)((function(){return u.find((function(e){var n;return e._id===(null===a||void 0===a||null===(n=a.template)||void 0===n?void 0:n._id)}))}),[a,u]),Y=(0,S.useMemo)((function(){return null!==J&&void 0!==J&&J.propertiesMap?Object.values(null===J||void 0===J?void 0:J.propertiesMap):[]}),[null===J||void 0===J?void 0:J.propertiesMap,J]),ee=(0,S.useMemo)((function(){return Y.length>0}),[Y.length]),ne=(0,S.useCallback)((function(e){o?s.updateVariationById({data:(0,w.Ts)(e,o),onSuccess:function(e){console.log("updateVariationById onSuccess",e),n&&n()},onError:C.kl.toastAxiosError,onLoading:j}).then():s.createVariation({data:(0,w.Ts)(e),onSuccess:function(e){d.state.close&&n&&n()},onError:C.kl.toastAxiosError,onLoading:j}).then(),r&&r(e)}),[n,r,s,d.state.close,o]),te=(0,S.useCallback)((function(e,n,t){M("propertiesMap.".concat(e),n),t&&G((function(n){return(0,h.Z)((0,h.Z)({},n),{},(0,p.Z)({},e,t))}))}),[M]),ie=(0,S.useCallback)((function(){M("propertiesMap",{}),G({})}),[M]),re=(0,S.useMemo)((function(){var e;return null===Q||void 0===Q||null===(e=Q.childrenList)||void 0===e?void 0:e.filter((function(e){return null===e||void 0===e?void 0:e.isSelectable}))}),[null===Q||void 0===Q?void 0:Q.childrenList]),oe=(0,S.useMemo)((function(){return null===re||void 0===re?void 0:re.map((function(e){return(0,T.jsx)(z,{item:e,selectedIds:Y,onSelect:te},"prop_".concat(e._id))}))}),[re,Y,te]);return(0,T.jsxs)(R,(0,h.Z)((0,h.Z)({onSubmit:F(ne),onReset:ie},l),{},{children:[(0,T.jsx)(y.iw,{onClose:n,title:t||(null===Q||void 0===Q?void 0:Q.label),canSubmit:ee,showSubmitButton:!0}),(0,T.jsxs)(q,{flex:1,fillWidth:!0,overflow:"auto",children:[(0,T.jsxs)(H,{padding:"0 8px",children:[(0,T.jsx)(L.Z,{label:(0,W.t)("label"),error:$.label,children:(0,T.jsx)(I.ZP,(0,h.Z)((0,h.Z)({},D("label",{required:!0})),{},{placeholder:(0,W.t)("label"),required:!0}))}),(0,T.jsxs)(Z.ZP,{fxDirection:"row",gap:8,fillWidth:!0,children:[(0,T.jsx)(L.Z,{label:(0,W.t)("sku"),error:$.sku,children:(0,T.jsx)(I.ZP,(0,h.Z)((0,h.Z)({},D("sku",{required:!0})),{},{placeholder:(0,W.t)("sku"),required:!0}))}),(0,T.jsx)(L.Z,{label:(0,W.t)("barCode"),error:$.barCode,children:(0,T.jsx)(I.ZP,(0,h.Z)((0,h.Z)({},D("barCode")),{},{placeholder:(0,W.t)("barCode")}))})]}),(0,T.jsx)(Z.ZP,{gap:8,fillWidth:!0,style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)"},children:E.map((function(e){return(0,T.jsx)(L.Z,{label:e.label,error:$[e.name],children:(0,T.jsx)(I.ZP,(0,h.Z)({placeholder:e.placeholder,min:1,type:"number"},D(e.name,{valueAsNumber:!0,min:1})))},e.name)}))})]}),(0,T.jsx)(O,{padding:"0 0 8px",margin:"8px 0 0",children:oe})]}),(0,T.jsx)(y.AT,{loading:b,resetButtonShown:!0,submitButtonText:b?"Loading...":o?"\u041f\u0456\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u0438":"\u0414\u043e\u0434\u0430\u0442\u0438",canSubmit:ee,extraFooter:(0,T.jsx)(N,{children:(0,T.jsx)(P.Z,(0,h.Z)({},d))})})]}))}},4838:function(e,n,t){t.d(n,{AT:function(){return Z},dF:function(){return v},iw:function(){return m}});var i,r,o,l=t(1413),d=t(4925),a=t(168),s=t(8095),u=t(8302),c=t(6492),p=t(2360),h=(t(2791),t(3329)),x=["children"],m=function(e){var n=e.onClose,t=e.title,i=e.showSubmitButton,r=e.canSubmit;return(0,h.jsx)(f,{padding:"4px 0",children:(0,h.jsxs)(s.ZP,{fillWidth:!0,fxDirection:"row",justifyContent:"space-between",alignItems:"stretch",height:"32px",children:[(0,h.jsx)(u.Z,{variant:"textExtraSmall",icon:"SmallArrowLeft",iconSize:"22px",padding:"0 6px",style:{minWidth:"max-content",minHeight:"100%"},onClick:n,children:"Back"}),(0,h.jsx)(s.ZP,{justifyContent:"center",overflow:"hidden",children:(0,h.jsx)(c.x,{$weight:600,$size:14,style:{textTransform:"uppercase",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},children:t})}),i&&(0,h.jsx)(u.Z,{variant:"textExtraSmall",gap:"6px",type:"submit",padding:"0 6px",endIcon:"done",endIconSize:"22px",style:{minWidth:"max-content",minHeight:"100%"},disabled:!r,children:"Ok"})]})})},f=(0,p.ZP)(s.ZP)(i||(i=(0,a.Z)(["\n  height: 32px;\n"]))),Z=function(e){var n=e.submitButtonText,t=void 0===n?"\u041f\u0440\u0438\u0439\u043d\u044f\u0442\u0438":n,i=e.loading,r=e.extraFooter,o=e.canSubmit,l=e.onCreatePress,d=e.resetButtonShown;return(0,h.jsxs)(b,{fillWidth:!0,children:[r,(0,h.jsxs)(s.ZP,{padding:"8px 8px",fxDirection:"row",gap:8,alignItems:"center",children:[d&&(0,h.jsx)(u.Z,{variant:"onlyIcon",icon:"clear",size:"36px",iconSize:"80%",type:"reset"}),l&&(0,h.jsx)(u.Z,{variant:"onlyIcon",icon:"plus",size:"36px",iconSize:"80%",onClick:l}),(0,h.jsx)(u.Z,{variant:"filledLarge",flex:1,type:"submit",style:{padding:"0 12px"},textTransform:"uppercase",fontWeight:600,endIcon:"SmallArrowRight",endIconSize:"24px",disabled:i||!o,children:t})]})]})},b=(0,p.ZP)(s.ZP)(r||(r=(0,a.Z)([""]))),v=function(e){var n=e.children,t=(0,d.Z)(e,x);return(0,h.jsx)(g,(0,l.Z)((0,l.Z)({},t),{},{children:n}))},g=p.ZP.form(o||(o=(0,a.Z)(["\n  flex: 1;\n\n  display: flex;\n  flex-direction: column;\n\n  width: 100%;\n  max-width: 480px;\n\n  padding: 0 8px;\n\n  background-color: ",";\n"])),(function(e){return e.theme.modalBackgroundColor}))}}]);
//# sourceMappingURL=753.57f75c2f.chunk.js.map
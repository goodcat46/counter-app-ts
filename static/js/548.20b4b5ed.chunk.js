"use strict";(self.webpackChunkmia_erp=self.webpackChunkmia_erp||[]).push([[548,264],{8548:function(e,o,a){a.r(o),a.d(o,{default:function(){return q},useOffersTableSettings:function(){return J}});var t,i=a(9439),n=a(168),l=a(1413),r=a(8589),s=a(8495),d=a(3350),f=a(2791),u=a(6931),c=a(7348),p=function(){return[]},h=a(3433),v=a(3665),m=a(3691),g=a(1819),x=a(6522),b=a(7264),Z=a(1494),j=a(2410),y=a(2989),I=a(3306),S=a(8095),D=a(389),C=a(8050),_=a(4990),V=a(6681),L=a(9006),P=a(8582),w=a(9964),A=a(3383),O=a(7802),T=a(870),F=a(9184),R=a(4809),k=a(9953),z=a(763),H=a(3329),M=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).loaders,o=(0,g.xc)().get(g.EJ.offers),a=(0,j.x)(),t=(0,v.f9)(),i=(0,c.i7)().dataMap;return(0,f.useCallback)((function(n){var l,r=null===(l=n.selectedRow)||void 0===l?void 0:l._id,s=r?null===i||void 0===i?void 0:i[r]:void 0;return[{name:"filter",icon:"filterOff",onClick:function(){t.create(W,{onSubmit:function(e){o.getAll({params:(0,I.vg)(e)})}})}},{separator:!0},{name:"refreshData",title:(0,x.t)("Refresh data"),icon:"refresh",type:"onlyIcon",onClick:function(){o.getAll({data:{refresh:!0},onLoading:e?e.onLoading("refresh"):n.onRefresh})}},{separator:!0},{name:"review",title:"\u041f\u0435\u0440\u0435\u0433\u043b\u044f\u0434 \u043f\u0440\u043e\u0434\u0443\u043a\u0442\u0443",icon:"openInNew",disabled:!r,type:"onlyIcon",navTo:"/app/".concat(a.params.permissionId,"/offers/")+r},{name:"edit",title:"\u0417\u043c\u0456\u043d\u0438\u0442\u0438",icon:"edit",iconSize:"90%",type:"onlyIcon",disabled:!r,onClick:function(){s?t.create(b.default,{offer:s}):r&&o.getOne({data:{data:{params:{_id:r}}},onLoading:e?e.onLoading("offer"):n.onRefresh,onSuccess:function(e){var o=e.data;t.create(b.default,{offer:o})}})}},{name:"copy",title:"\u041a\u043e\u043f\u0456\u044e\u0432\u0430\u0442\u0438",icon:"copy",iconSize:"90%",type:"onlyIcon",disabled:!s,onClick:function(){s&&t.create(b.default,{offer:s,copy:!0})}},{name:"archiveOffer",title:"\u0410\u0440\u0445\u0456\u0432",icon:"archive",iconSize:"90%",type:"onlyIcon",disabled:!0},{separator:!0},{name:"createOffer",title:"\u041d\u043e\u0432\u0438\u0439",icon:"plus",iconSize:"90%",type:"onlyIconFilled",disabled:!1,onClick:function(){t.create(Z.default)}}]}),[e,t,a,o,i])},$=["createdAt","updatedAt","deletedAt"],W=function(e){var o,a,t=e.onSubmit,n=e.onClose,r=(0,c.q$)(T.cA.TAGS),s=(0,c.q$)(T.cA.BRANDS),d=(0,c.q$)(T.cA.CATEGORIES_PROD),u=(0,c.WS)(),p=(0,c.eO)().warehouses,v=(0,y.hN)(),g=(0,I.H1)(m.Hb),b=(0,f.useState)(),Z=(0,i.Z)(b,2),j=Z[0],M=Z[1],W=(0,f.useMemo)((function(){return{tags:r.directory.map((function(e,o){var a;return(0,l.Z)((0,l.Z)({},e),{},{label:null!==(a=e.label)&&void 0!==a?a:"Item ".concat(o),value:e._id,name:""})})),categories:d.directory.map((function(e,o){var a;return(0,l.Z)((0,l.Z)({},e),{},{label:null!==(a=e.label)&&void 0!==a?a:"Item ".concat(o),value:e._id,name:""})})),brands:s.directory.map((function(e,o){var a;return(0,l.Z)((0,l.Z)({},e),{},{label:null!==(a=e.label)&&void 0!==a?a:"Item ".concat(o),value:e._id,name:""})})),properties:u.map((function(e,o){var a;return(0,l.Z)((0,l.Z)({},e),{},{label:null!==(a=e.label)&&void 0!==a?a:"Item ".concat(o),value:e._id,name:""})})),warehouses:p.map((function(e,o){var a;return(0,l.Z)((0,l.Z)({},e),{},{label:null!==(a=e.label)&&void 0!==a?a:"Item ".concat(o),value:e._id,name:""})}))}}),[s.directory,d.directory,u,r.directory,p]);return(0,H.jsx)(C.Z,{title:"Filter",onClose:n,children:(0,H.jsxs)(S._0,{padding:"8px",onSubmit:v.handleSubmit((function(e){console.log(e),t&&t((0,z.omit)(e,["propsIdsMap"]))})),children:[(0,H.jsx)(_.Z,{label:(0,x.t)("Status"),children:(0,H.jsx)(O.Z,{onSelectValue:function(e){v.setValue("approved",e.value)},value:v.formValues.approved?[v.formValues.approved]:void 0,options:g})}),(0,H.jsx)(_.Z,{label:(0,x.t)("Type"),children:(0,H.jsx)(w.Z,{value:v.formValues.type,options:A.LC,form:v})}),(0,H.jsx)(_.Z,{label:(0,x.t)("Visibility"),children:(0,H.jsx)(D.Z,{name:"visible",value:v.formValues.visible,onChange:function(e){v.setValue("visible",e,{shouldTouch:!0,shouldDirty:!0})}})}),(0,H.jsx)(L.y,{hideFooter:!0,label:"Tags",children:(0,H.jsx)(O.Z,{multiple:!0,onChange:function(e){v.setValue("tagsIds",e)},value:v.formValues.tagsIds,options:W.tags})}),(0,H.jsx)(L.y,{hideFooter:!0,label:"Categories",maxHeight:"500px",children:(0,H.jsx)(F.Z,{onChangeIds:function(e){v.setValue("categoriesIds",e)},selectedIds:v.formValues.categoriesIds})}),(0,H.jsxs)(L.y,{hideFooter:!0,label:"Properties",children:[(0,H.jsx)(k.Z,{options:u,defaultOption:j,onOptSelect:function(e){M(e)}}),null===j||void 0===j||null===(o=j.childrenList)||void 0===o?void 0:o.map((function(e){var o;return(0,H.jsx)(R.Z,{item:e,multiple:!0,selectedIds:null===(o=v.formValues.propsIdsMap)||void 0===o?void 0:o[e._id],onChangeIds:function(e,o){var a;v.setValue("propsIdsMap.".concat(e),o,{shouldDirty:!0,shouldTouch:!0}),v.setValue("propertiesIds",Array.from(new Set([].concat((0,h.Z)(null!==(a=v.formValues.propertiesIds)&&void 0!==a?a:[]),(0,h.Z)(o)))),{shouldDirty:!0,shouldTouch:!0})}},e._id)}))]}),(0,H.jsx)(L.y,{hideFooter:!0,label:"Brands",children:(0,H.jsx)(O.Z,{multiple:!0,onChange:function(e){v.setValue("brandsIds",e)},value:v.formValues.brandsIds,options:W.brands})}),(0,H.jsx)(L.y,{hideFooter:!0,label:"Warehouses",children:(0,H.jsx)(O.Z,{multiple:!0,onChange:function(e){v.setValue("warehouse.ids",e)},value:null===(a=v.formValues.warehouse)||void 0===a?void 0:a.ids,options:W.warehouses})}),(0,H.jsx)(L.y,{label:"Date fields",hideFooter:!0,children:$.map((function(e){return(0,H.jsxs)(S.hs,{gap:12,fxDirection:"row",fillWidth:!0,xsStyles:{fxDirection:"column",gap:0,margin:"0 0 8px"},children:[(0,H.jsx)(_.Z,{flex:1,label:"".concat((0,x.t)(e)," ").concat((0,x.t)("From").toLowerCase(),":"),children:(0,H.jsx)(V.ZP,(0,l.Z)({type:"datetime-local"},v.register("".concat(e,".dateFrom"))))}),(0,H.jsx)(_.Z,{flex:1,label:"".concat((0,x.t)(e)," ").concat((0,x.t)("To").toLowerCase(),":"),children:(0,H.jsx)(V.ZP,(0,l.Z)({type:"datetime-local"},v.register("".concat(e,".dateTo"))))})]},e)}))}),(0,H.jsx)(P.Z,{hasOnSubmit:!0})]})})},B=a(4897),E=a(9541),G=a(7824),U=(0,d.ZP)(S.ZP)(t||(t=(0,n.Z)(["\n  ","\n"])),s.VU),q=function(e){var o=J({}),a=o.tableConfig,t=o.isLoading;return(0,H.jsx)(u.default,{path:e.path,children:(0,H.jsx)(U,{children:(0,H.jsx)(r.ZP,(0,l.Z)((0,l.Z)({},a),{},{showFooter:!0,isLoading:null===t||void 0===t?void 0:t.offers}))})})},J=function(e){var o=e.searchState,a=e.sortState,t=(0,E.J)({offers:{content:"Refreshing..."},refresh:{content:"Refreshing..."},offer:{content:"Refreshing..."}}),n=t.onLoading,l=t.isLoading,r=(0,g.xc)().get(G.d.offers).getAll,s=(0,c.i7)(),d=p(),u=M({loaders:t}),h=(0,f.useState)(a),v=(0,i.Z)(h,2),m=v[0],x=v[1],b=(0,f.useState)(o),Z=(0,i.Z)(b,2),j=Z[0],y=Z[1],S=(0,f.useMemo)((function(){return{onSubmitSearch:function(e){if(e.search){var o,a={},t=null===(o=e.param)||void 0===o?void 0:o.dataPath;t&&e.search&&(0,I.P_)(t,e.search,a,{mutation:!0}),y(e),r({params:a,onLoading:n("offers")}).then()}else r({onLoading:n("offers")}).then()},tableData:s.list,tableTitles:B.Y5,searchParams:B.Dr,sortParams:B.Cs,filterSelectors:d,hasFilter:!1,hasSearch:!0,showFooter:!1,checkBoxes:!0,actionsCreator:u,onTableSortChange:function(e,o){x({param:e,order:o}),console.log({param:e,order:o}),r({params:{sortOrder:o,sortPath:e.dataPath},onLoading:n("offers")}).then()}}}),[u,d,r,n,s.list]);return(0,f.useEffect)((function(){0===s.list.length&&r({onLoading:n("offers")})}),[]),{tableConfig:S,isLoading:l,sortParams:m,searchParams:j}}},7264:function(e,o,a){a.r(o);var t=a(1413),i=a(9420),n=a(8050),l=a(6522),r=a(3306),s=a(3691),d=a(9306),f=a(3007),u=a(8095),c=a(6653),p=a(6492),h=a(9541),v=a(7578),m=a(8160),g=a(5888),x=a(2989),b=a(7608),Z=a(5248),j=a(5169),y=a(3331),I=a(3329);o.default=function(e){var o,a,S,D,C,_,V,L,P,w,A,O=e.onClose,T=e.offer,F=e.copy,R=(0,x.G2)(T),k=(0,h.J)({offer_refresh:{content:"Refreshing..."},offer_update:{content:"Updating..."}},{formData:R?(0,r.xT)(R):{type:s.iv.GOODS}}),z=k.setData,H=k.state,M=F?null===(o=H.formData)||void 0===o?void 0:o._id:null===R||void 0===R?void 0:R._id;return R?(0,I.jsx)(n.Z,{fillHeight:!0,title:F?(0,l.t)("Copy offer"):(0,l.t)("Update offer"),onClose:O,children:(0,I.jsx)(v.f4,{value:k,children:null!==(a=k.isLoading)&&void 0!==a&&a.offer?(0,I.jsxs)(u.ZP,{fillWidth:!0,padding:"24px",alignItems:"center",gap:16,children:[(0,I.jsx)(c.$,{size:52}),(0,I.jsx)(p.x,{children:(0,l.t)("Loading info about offer...")})]}):(0,I.jsxs)(u.ZP,{padding:"0 0 16px",children:[(0,I.jsx)(f.B,{_id:M,edit:!F,type:null===(S=H.formData)||void 0===S?void 0:S.type,defaultValues:null===H||void 0===H?void 0:H.formData,onSuccess:function(e){var o=e.data;z("formData",F?(0,t.Z)((0,t.Z)({},(0,r.xT)(o)),{},{_id:o._id}):(0,r.xT)(o))}}),(0,I.jsx)(b.A,{_id:M,offer:R,defaultValues:null===(D=H.formData)||void 0===D?void 0:D.categoriesIds,disabled:!H.formData}),(0,I.jsx)(m.R,{_id:M,offer:R,defaultValues:null===(C=H.formData)||void 0===C?void 0:C.propertiesIds,disabled:!H.formData}),(0,I.jsx)(Z.L,{expandable:!0,isOpen:!1,offer:R,defaultState:null===R||void 0===R?void 0:R.price,price:null===R||void 0===R?void 0:R.price,title:(0,l.t)("Price")}),(null===R||void 0===R?void 0:R.price)&&(0,I.jsx)(y.Z,{price:null===R||void 0===R?void 0:R.price}),(0,I.jsx)(g.A,{offer:R,defaultValues:null===H||void 0===H||null===(_=H.formData)||void 0===_?void 0:_.images,disabled:!(null!==H&&void 0!==H&&H.formData),_id:M}),(0,I.jsx)(j.Z,{_id:M,offer:R,defaultValues:null===(V=H.formData)||void 0===V?void 0:V.tagsIds,disabled:!H.formData}),(0,I.jsx)(i.A,{offer:R,defaultValues:null===(L=H.formData)||void 0===L?void 0:L.dimensions,disabled:F?!(null!==(P=H.formData)&&void 0!==P&&P._id&&H.formData):!M,_id:M}),(0,I.jsx)(d.n,{offer:R,defaultValues:null===(w=H.formData)||void 0===w?void 0:w.measurement,disabled:F?!(null!==(A=H.formData)&&void 0!==A&&A._id&&H.formData):!M,_id:M})]})})}):(0,I.jsx)(n.Z,{title:F?(0,l.t)("Copy offer"):(0,l.t)("Update offer"),fillHeight:!0,children:(0,I.jsx)(u.ZP,{fillWidth:!0,fillHeight:!0,padding:"26px",alignItems:"center",justifyContent:"center",children:(0,I.jsx)(p.x,{$size:16,$weight:600,children:(0,l.t)("Offer not found")})})})}}}]);
//# sourceMappingURL=548.20b4b5ed.chunk.js.map
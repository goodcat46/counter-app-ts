"use strict";(self.webpackChunkmia_erp=self.webpackChunkmia_erp||[]).push([[548,264],{8548:function(e,o,t){t.r(o),t.d(o,{default:function(){return q},useOffersTableSettings:function(){return J}});var a,n=t(9439),i=t(168),r=t(1413),l=t(8589),s=t(8495),d=t(2360),u=t(2791),c=t(6931),f=t(7348),p=function(){return[]},h=t(3433),m=t(3665),v=t(3691),g=t(1819),x=t(6522),b=t(7264),Z=t(1494),j=t(2410),y=t(2989),S=t(959),I=t(8095),C=t(389),D=t(8050),V=t(4990),_=t(6681),L=t(9006),P=t(8582),w=t(9964),A=t(3383),T=t(7802),O=t(870),F=t(9184),R=t(4809),k=t(9953),z=t(763),H=t(3329),M=function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).loaders,o=(0,g.xc)().get(g.EJ.offers),t=(0,j.x)(),a=(0,m.f9)(),n=(0,f.i7)().dataMap;return(0,u.useCallback)((function(i){var r,l=null===(r=i.selectedRow)||void 0===r?void 0:r._id,s=l?null===n||void 0===n?void 0:n[l]:void 0;return[{name:"filter",icon:"filterOff",onClick:function(){a.create(U,{onSubmit:function(e){o.getAll({params:(0,S.vg)(e)})}})}},{separator:!0},{name:"refreshData",title:(0,x.t)("Refresh data"),icon:"refresh",type:"onlyIcon",onClick:function(){o.getAll({data:{refresh:!0},onLoading:e?e.onLoading("refresh"):i.onRefresh})}},{separator:!0},{name:"review",title:"\u041f\u0435\u0440\u0435\u0433\u043b\u044f\u0434 \u043f\u0440\u043e\u0434\u0443\u043a\u0442\u0443",icon:"openInNew",disabled:!l,type:"onlyIcon",navTo:"/app/".concat(t.params.permissionId,"/offers/")+l},{name:"edit",title:"\u0417\u043c\u0456\u043d\u0438\u0442\u0438",icon:"edit",iconSize:"90%",type:"onlyIcon",disabled:!l,onClick:function(){s?a.create(b.default,{offer:s}):l&&o.getOne({data:{data:{params:{_id:l}}},onLoading:e?e.onLoading("offer"):i.onRefresh,onSuccess:function(e){var o=e.data;a.create(b.default,{offer:o})}})}},{name:"copy",title:"\u041a\u043e\u043f\u0456\u044e\u0432\u0430\u0442\u0438",icon:"copy",iconSize:"90%",type:"onlyIcon",disabled:!s,onClick:function(){s&&a.create(b.default,{offer:s,copy:!0})}},{name:"archiveOffer",title:"\u0410\u0440\u0445\u0456\u0432",icon:"archive",iconSize:"90%",type:"onlyIcon",disabled:!0},{separator:!0},{name:"createOffer",title:"\u041d\u043e\u0432\u0438\u0439",icon:"plus",iconSize:"90%",type:"onlyIconFilled",disabled:!1,onClick:function(){a.create(Z.default)}}]}),[e,a,t,o,n])},$=["createdAt","updatedAt","deletedAt"],U=function(e){var o,t,a=e.onSubmit,i=e.onClose,l=(0,f.q$)(O.cA.TAGS),s=(0,f.q$)(O.cA.BRANDS),d=(0,f.q$)(O.cA.CATEGORIES_PROD),c=(0,f.WS)(),p=(0,f.eO)().warehouses,m=(0,y.hN)(),g=(0,S.H1)(v.Hb),b=(0,u.useState)(),Z=(0,n.Z)(b,2),j=Z[0],M=Z[1],U=(0,u.useMemo)((function(){return{tags:l.directory.map((function(e,o){var t;return(0,r.Z)((0,r.Z)({},e),{},{label:null!==(t=e.label)&&void 0!==t?t:"Item ".concat(o),value:e._id,name:""})})),categories:d.directory.map((function(e,o){var t;return(0,r.Z)((0,r.Z)({},e),{},{label:null!==(t=e.label)&&void 0!==t?t:"Item ".concat(o),value:e._id,name:""})})),brands:s.directory.map((function(e,o){var t;return(0,r.Z)((0,r.Z)({},e),{},{label:null!==(t=e.label)&&void 0!==t?t:"Item ".concat(o),value:e._id,name:""})})),properties:c.map((function(e,o){var t;return(0,r.Z)((0,r.Z)({},e),{},{label:null!==(t=e.label)&&void 0!==t?t:"Item ".concat(o),value:e._id,name:""})})),warehouses:p.map((function(e,o){var t;return(0,r.Z)((0,r.Z)({},e),{},{label:null!==(t=e.label)&&void 0!==t?t:"Item ".concat(o),value:e._id,name:""})}))}}),[s.directory,d.directory,c,l.directory,p]);return(0,H.jsx)(D.Z,{title:"Filter",onClose:i,children:(0,H.jsxs)(I._0,{padding:"8px",onSubmit:m.handleSubmit((function(e){console.log(e),a&&a((0,z.omit)(e,["propsIdsMap"]))})),children:[(0,H.jsx)(V.Z,{label:(0,x.t)("Status"),children:(0,H.jsx)(T.Z,{onSelectValue:function(e){m.setValue("approved",e.value)},value:m.formValues.approved?[m.formValues.approved]:void 0,options:g})}),(0,H.jsx)(V.Z,{label:(0,x.t)("Type"),children:(0,H.jsx)(w.Z,{value:m.formValues.type,options:A.LC,form:m})}),(0,H.jsx)(V.Z,{label:(0,x.t)("Visibility"),children:(0,H.jsx)(C.Z,{name:"visible",value:m.formValues.visible,onChange:function(e){m.setValue("visible",e,{shouldTouch:!0,shouldDirty:!0})}})}),(0,H.jsx)(L.y,{hideFooter:!0,label:"Tags",children:(0,H.jsx)(T.Z,{multiple:!0,onChange:function(e){m.setValue("tagsIds",e)},value:m.formValues.tagsIds,options:U.tags})}),(0,H.jsx)(L.y,{hideFooter:!0,label:"Categories",maxHeight:"500px",children:(0,H.jsx)(F.Z,{onChangeIds:function(e){m.setValue("categoriesIds",e)},selectedIds:m.formValues.categoriesIds})}),(0,H.jsxs)(L.y,{hideFooter:!0,label:"Properties",children:[(0,H.jsx)(k.Z,{options:c,defaultOption:j,onOptSelect:function(e){M(e)}}),null===j||void 0===j||null===(o=j.childrenList)||void 0===o?void 0:o.map((function(e){var o;return(0,H.jsx)(R.Z,{item:e,multiple:!0,selectedIds:null===(o=m.formValues.propsIdsMap)||void 0===o?void 0:o[e._id],onChangeIds:function(e,o){var t;m.setValue("propsIdsMap.".concat(e),o,{shouldDirty:!0,shouldTouch:!0}),m.setValue("propertiesIds",Array.from(new Set([].concat((0,h.Z)(null!==(t=m.formValues.propertiesIds)&&void 0!==t?t:[]),(0,h.Z)(o)))),{shouldDirty:!0,shouldTouch:!0})}},e._id)}))]}),(0,H.jsx)(L.y,{hideFooter:!0,label:"Brands",children:(0,H.jsx)(T.Z,{multiple:!0,onChange:function(e){m.setValue("brandsIds",e)},value:m.formValues.brandsIds,options:U.brands})}),(0,H.jsx)(L.y,{hideFooter:!0,label:"Warehouses",children:(0,H.jsx)(T.Z,{multiple:!0,onChange:function(e){m.setValue("warehouse.ids",e)},value:null===(t=m.formValues.warehouse)||void 0===t?void 0:t.ids,options:U.warehouses})}),(0,H.jsx)(L.y,{label:"Date fields",hideFooter:!0,children:$.map((function(e){return(0,H.jsxs)(I.hs,{gap:12,fxDirection:"row",fillWidth:!0,xsStyles:{fxDirection:"column",gap:0,margin:"0 0 8px"},children:[(0,H.jsx)(V.Z,{flex:1,label:"".concat((0,x.t)(e)," ").concat((0,x.t)("From").toLowerCase(),":"),children:(0,H.jsx)(_.ZP,(0,r.Z)({type:"datetime-local"},m.register("".concat(e,".dateFrom"))))}),(0,H.jsx)(V.Z,{flex:1,label:"".concat((0,x.t)(e)," ").concat((0,x.t)("To").toLowerCase(),":"),children:(0,H.jsx)(_.ZP,(0,r.Z)({type:"datetime-local"},m.register("".concat(e,".dateTo"))))})]},e)}))}),(0,H.jsx)(P.Z,{onSubmitPassed:!0})]})})},W=t(4897),B=t(9541),E=t(7824),G=(0,d.ZP)(I.ZP)(a||(a=(0,i.Z)(["\n  ","\n"])),s.VU),q=function(e){var o=J({}),t=o.tableConfig,a=o.isLoading;return(0,H.jsx)(c.default,{path:e.path,children:(0,H.jsx)(G,{children:(0,H.jsx)(l.ZP,(0,r.Z)((0,r.Z)({},t),{},{showFooter:!0,isLoading:null===a||void 0===a?void 0:a.offers}))})})},J=function(e){var o=e.searchState,t=e.sortState,a=(0,B.J)({offers:{content:"Refreshing..."},refresh:{content:"Refreshing..."},offer:{content:"Refreshing..."}}),i=a.onLoading,r=a.isLoading,l=(0,g.xc)().get(E.d.offers).getAll,s=(0,f.i7)(),d=p(),c=M({loaders:a}),h=(0,u.useState)(t),m=(0,n.Z)(h,2),v=m[0],x=m[1],b=(0,u.useState)(o),Z=(0,n.Z)(b,2),j=Z[0],y=Z[1],I=(0,u.useMemo)((function(){return{onSubmitSearch:function(e){if(e.search){var o,t={},a=null===(o=e.param)||void 0===o?void 0:o.dataPath;a&&e.search&&(0,S.P_)(a,e.search,t,{mutation:!0}),y(e),l({params:t,onLoading:i("offers")}).then()}else l({onLoading:i("offers")}).then()},tableData:s.list,tableTitles:W.Y5,searchParams:W.Dr,sortParams:W.Cs,filterSelectors:d,hasFilter:!1,hasSearch:!0,showFooter:!1,checkBoxes:!0,actionsCreator:c,onTableSortChange:function(e,o){x({param:e,order:o}),console.log({param:e,order:o}),l({params:{sortOrder:o,sortPath:e.dataPath},onLoading:i("offers")}).then()}}}),[c,d,l,i,s.list]);return(0,u.useEffect)((function(){0===s.list.length&&l({onLoading:i("offers")})}),[]),{tableConfig:I,isLoading:r,sortParams:v,searchParams:j}}},8495:function(e,o,t){t.d(o,{SI:function(){return d},VU:function(){return s}});var a,n,i,r=t(168),l=t(2360),s=(0,l.iv)(a||(a=(0,r.Z)(["\n  grid-column: 1/13;\n  grid-row: 1/13;\n"]))),d=(0,l.iv)(n||(n=(0,r.Z)(["\n  width: 100%;\n  height: 100%;\n"])));(0,l.iv)(i||(i=(0,r.Z)(["\n  outline: 1px solid tomato;\n"])))},7264:function(e,o,t){t.r(o);var a=t(1413),n=t(9420),i=t(8050),r=t(6522),l=t(959),s=t(3691),d=t(9306),u=t(3007),c=t(8095),f=t(6653),p=t(6492),h=t(9541),m=t(7578),v=t(8160),g=t(5888),x=t(2989),b=t(7608),Z=t(5248),j=t(3329);o.default=function(e){var o,t,y,S,I,C,D,V,_,L,P=e.onClose,w=e.offer,A=e.copy,T=(0,x.G2)(w),O=(0,h.J)({offer_refresh:{content:"Refreshing..."},offer_update:{content:"Updating..."}},{formData:T?(0,l.xT)(T):{type:s.iv.GOODS}}),F=O.setData,R=O.state,k=A?null===(o=R.formData)||void 0===o?void 0:o._id:null===T||void 0===T?void 0:T._id;return T?(0,j.jsx)(i.Z,{fillHeight:!0,title:A?(0,r.t)("Copy offer"):(0,r.t)("Update offer"),onClose:P,children:(0,j.jsx)(m.f4,{value:O,children:null!==(t=O.isLoading)&&void 0!==t&&t.offer?(0,j.jsxs)(c.ZP,{fillWidth:!0,padding:"24px",alignItems:"center",gap:16,children:[(0,j.jsx)(f.$,{size:52}),(0,j.jsx)(p.x,{children:(0,r.t)("Loading info about offer...")})]}):(0,j.jsxs)(c.ZP,{padding:"0 0 16px",children:[(0,j.jsx)(u.B,{_id:k,edit:!A,type:null===(y=R.formData)||void 0===y?void 0:y.type,defaultValues:null===R||void 0===R?void 0:R.formData,onSuccess:function(e){var o=e.data;F("formData",A?(0,a.Z)((0,a.Z)({},(0,l.xT)(o)),{},{_id:o._id}):(0,l.xT)(o))}}),(0,j.jsx)(b.A,{_id:k,offer:T,defaultValues:null===(S=R.formData)||void 0===S?void 0:S.categories,disabled:!R.formData}),(0,j.jsx)(v.R,{_id:k,offer:T,defaultValues:null===(I=R.formData)||void 0===I?void 0:I.properties,disabled:!R.formData}),(0,j.jsx)(Z.L,{expandable:!0,isOpen:!1,offer:T,defaultState:null===T||void 0===T?void 0:T.price,price:null===T||void 0===T?void 0:T.price,title:(0,r.t)("Price")}),(0,j.jsx)(g.A,{offer:T,defaultValues:null===R||void 0===R||null===(C=R.formData)||void 0===C?void 0:C.images,disabled:!(null!==R&&void 0!==R&&R.formData),_id:k}),(0,j.jsx)(n.A,{offer:T,defaultValues:null===(D=R.formData)||void 0===D?void 0:D.dimensions,disabled:A?!(null!==(V=R.formData)&&void 0!==V&&V._id&&R.formData):!k,_id:k}),(0,j.jsx)(d.n,{offer:T,defaultValues:null===(_=R.formData)||void 0===_?void 0:_.measurement,disabled:A?!(null!==(L=R.formData)&&void 0!==L&&L._id&&R.formData):!k,_id:k})]})})}):(0,j.jsx)(i.Z,{title:A?(0,r.t)("Copy offer"):(0,r.t)("Update offer"),fillHeight:!0,children:(0,j.jsx)(c.ZP,{fillWidth:!0,fillHeight:!0,padding:"26px",alignItems:"center",justifyContent:"center",children:(0,j.jsx)(p.x,{$size:16,$weight:600,children:(0,r.t)("Offer not found")})})})}}}]);
//# sourceMappingURL=548.1e9ebe6d.chunk.js.map